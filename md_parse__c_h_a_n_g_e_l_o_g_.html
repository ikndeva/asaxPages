<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>asax02.neo: CHANGELOG.md: asax02neo.query.g4</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="myextrastysheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">asax02.neo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_parse__c_h_a_n_g_e_l_o_g_.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CHANGELOG.md: asax02neo.query.g4 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>180219 created by <a href="#" onclick="location.href='mai'+'lto:'+'ari'+'m@'+'ist'+'.h'+'oku'+'da'+'i.a'+'c.'+'jp'; return false;">arim@<span style="display: none;">.nosp@m.</span>ist.<span style="display: none;">.nosp@m.</span>hokud<span style="display: none;">.nosp@m.</span>ai.a<span style="display: none;">.nosp@m.</span>c.jp</a></p>
<h1>180221: design of tree automata</h1>
<p>Def: A <em>rule</em> is an expression in the form of <code>i &lt;= tag [ j_1 ... j_k ]</code>, where</p>
<ul>
<li>an integer <code>k</code> is called an arity,</li>
<li>integers <code>i, j_1, ..., j_k</code> are states. The state <code>i</code> is the parent, and the state $j_h$ is the <code>h</code>-th child for $1\le h\le k$.</li>
</ul>
<p>The bottom up evaluation is done by the following procedure:</p>
<div class="fragment"><div class="line">def bottom-up evaluation: </div>
<div class="line">    input: event stream E. </div>
<div class="line">    output:</div>
<div class="line">    Stack S := new Stack();</div>
<div class="line">    S.top().putState(s_top, false)    #top state</div>
<div class="line">    </div>
<div class="line">    while (E has next event e): </div>
<div class="line">        switch (e.type): </div>
<div class="line"> </div>
<div class="line">      START_EVENT: </div>
<div class="line">        S.push(new Scope()); #scope begin</div>
<div class="line">        tagID := intern(e.tag)</div>
<div class="line">        S.top().putInteger(&quot;TAGID&quot;, tagID)</div>
<div class="line">        for r in HIT_RULES[tagID]: </div>
<div class="line">            s_parent := r.consequence(): </div>
<div class="line">            if S.nextTop().hasState(s_parent): #activation check</div>
<div class="line">                for j in r.antecidents(): </div>
<div class="line">                    S.top().putState(j, false)</div>
<div class="line">        break; </div>
<div class="line"> </div>
<div class="line">      END_EVENT:</div>
<div class="line">        tagID := S.top().getInteger(&quot;TAGID&quot;)</div>
<div class="line">        for r in HIT_RULES[tagID]: </div>
<div class="line">            s_parent := r.consequence(): </div>
<div class="line">            if S.nextTop().hasState(s_parent): #activation check</div>
<div class="line">                succ := false</div>
<div class="line">                for s_child in r.antecidents(): #state</div>
<div class="line">                    succ := succ and S.top().getState(s_child)</div>
<div class="line">                succ := succ and evalCode(r.postcode)</div>
<div class="line">                if (succ):</div>
<div class="line">                    S.nextTop().putState(s_parent, true) #state</div>
<div class="line">                    S.pop() #scope end</div>
<div class="line">        break; </div>
<div class="line"> </div>
<div class="line">        #switch</div>
<div class="line">    #while</div>
</div><!-- fragment --><h1>180220: query design2</h1>
<div class="fragment"><div class="line">for p in database/book: </div>
<div class="line">where p.age &lt; 22 and p.date.year &gt;= 2000 and p.title =~ m/.*XML.*/: </div>
<div class="line">orderby p.type, p.date.year, p.date.month, p.date.day, p.name: </div>
<div class="line">return </div>
<div class="line">  item: {</div>
<div class="line">    ti: p.title, pubyear: p.date.year, </div>
<div class="line">    shoplist: </div>
<div class="line">      for s in p/shop: </div>
<div class="line">      orderby s.location.latitude: </div>
<div class="line">      return s.name, s.location.address</div>
<div class="line">  }</div>
</div><!-- fragment --><ul>
<li>for 文<ul>
<li>for文は、return文と対になって、リストの出力を記述する。</li>
<li>入力リストは、通常のリスト、順序辞書、辞書のいずれでもよいとする。</li>
<li>入力リストの各要素を操作し、要素を指し示すカーソルを返す。</li>
<li>出力は、リスト。囲みの角カッコは省略可能。</li>
</ul>
</li>
<li>where文<ul>
<li>カーソルで指し示された要素に対してフィルタ式を用いて検査を行い、真偽値を返す。</li>
<li>フィルタ式は、現在のカーソルで決まる文脈上の次の式からなる:<ul>
<li>数値関係式</li>
<li>文字列照合式</li>
<li>パス式</li>
<li>論理式</li>
</ul>
</li>
<li>結果が真となる要素のみを出力し、偽となる要素はスキップする。</li>
</ul>
</li>
<li>orderby文とgroupby文は、キーとデータアイテムの対の出力方法を指定する。<ul>
<li>orderby文は、キーとデータアイテムの対の順序辞書への出力を指定する。</li>
<li>groupby文は、キーとデータアイテムの対の（非順序）辞書への出力を指定する。</li>
<li>キーは文字列であり、要素の出力を区切り記号で連結して生成する。</li>
<li>オブジェクトブロックとリストのカッコは必要最小限の記述で可にする。</li>
</ul>
</li>
<li>return文は、for文で出力する各オブジェクトの出力方法を指定する。<ul>
<li>for文でそれらを要素として含むリストを出力する。</li>
<li>object構成文の出力は、オブジェクト。囲みのカッコは省略可能。</li>
</ul>
</li>
</ul>
<h1>180220: query design</h1>
<ul>
<li>一般式から、基礎式への変換。一般式</li>
</ul>
<div class="fragment"><div class="line">database/book [ age &lt; 22 and year &gt;= 2000 and title =~ m/.*XML.*/ ] </div>
</div><!-- fragment --><p>から次の基礎式へ変換する。</p>
<div class="fragment"><div class="line">//query q1</div>
<div class="line">database/book [</div>
<div class="line">  age[ number($_) &lt; 22 ] and</div>
<div class="line">  year[ number($_) &gt;= 2000 ] and</div>
<div class="line">  title[ $_ =~ m/.*XML.*/ ]</div>
<div class="line">] </div>
</div><!-- fragment --><div class="fragment"><div class="line">def q1:</div>
<div class="line">database/book</div>
<div class="line">{ watching age, year, title; }</div>
<div class="line">[</div>
<div class="line">  b0 = age { i_push i_const(22); i_push number($_); i_lt; }; </div>
<div class="line">  b1 = year { i_push i_const(2000); i_push number($_); i_ge; }; </div>
<div class="line">  b2 = title { s_push string($_); s_push /.*XML.*/; s_match; };</div>
<div class="line">]</div>
<div class="line">{ if (b0 and b1 and b2) then return $_; }</div>
</div><!-- fragment --><div class="fragment"><div class="line">defruleset {</div>
<div class="line">defrule top </div>
<div class="line">  { watching b1; }</div>
<div class="line">  { b_push b1; iffalse o_pop else o_return; }  </div>
<div class="line"> </div>
<div class="line">defrule b1 &#39;database&#39; top</div>
<div class="line">  { o_push $_; watching b2; }</div>
<div class="line">  { b_push b2; iffalse o_pop; }  </div>
<div class="line"> </div>
<div class="line">defrule b2 &#39;book&#39; b1</div>
<div class="line">  { o_push $_; watching b3, b4, b5; }</div>
<div class="line">  { b_push (b0 and b1 and b2); iffalse o_pop; }</div>
<div class="line"> </div>
<div class="line">defrule b3 &#39;age&#39; {}</div>
<div class="line">  { o_push $_; i_push i_const(22); i_push number($_); i_lt; iffalse o_pop; }; </div>
<div class="line"> </div>
<div class="line">defrule b4 &#39;year&#39; {}</div>
<div class="line">  { o_push $_; i_push i_const(2000); i_push number($_); i_ge; iffalse o_pop; }; </div>
<div class="line"> </div>
<div class="line">defrule b5 &#39;title&#39; {}</div>
<div class="line">  { o_push $_; s_push string($_); s_push s_const(/.*XML.*/); s_match; iffalse o_pop; };</div>
<div class="line">}//ruleset</div>
</div><!-- fragment --><h1>180219: query.g4</h1>
<ul>
<li>andexpr: 従来、左再帰になるため、<code>andexpr</code>の項として一般の式<code>expr</code>を含めることができなかった問題を解決した。解決として、項として、<code>andexpr</code>のルールにおいて再帰になる式を1組のカッコ対<code>(</code>と<code>)</code>で囲み、任意の<code>expr</code>を含めるようにした。</li>
<li>stringrel: Perl形式の正規表現の照合式 <code>title =~ m/.*XML.*/</code> を使えるようにした。</li>
</ul>
<div class="fragment"><div class="line">predicate : (&#39;[&#39; andexpr &#39;]&#39;)? ;</div>
<div class="line"> </div>
<div class="line">/// 論理式</div>
<div class="line">andexpr : expr (&#39;and&#39; expr)* ; </div>
<div class="line">expr</div>
<div class="line">    :  number #NumberExp</div>
<div class="line">    |  arithRel #ArithRelExp</div>
<div class="line">    |  stringRel #StrRelExp</div>
<div class="line">    |  &#39;(&#39; andexpr &#39;)&#39; #AndExp</div>
<div class="line">    |  step #StepExp</div>
<div class="line">    | #EmptyExp</div>
<div class="line">    ;</div>
<div class="line"> </div>
<div class="line">/// 数値比較式</div>
<div class="line">arithRel : name ARITHBOP number ;</div>
<div class="line">ARITHBOP : &#39;==&#39; | &#39;!=&#39; | &#39;&lt;=&#39; | &#39;&lt;&#39; | &#39;&gt;=&#39; | &#39;&gt;&#39; ; </div>
<div class="line"> </div>
<div class="line">/// 文字列照合式</div>
<div class="line">stringRel : name STRINGBOP MATCHEXP ;</div>
<div class="line">STRINGBOP : &#39;=~&#39; | &#39;!~&#39; ;</div>
<div class="line">MATCHEXP : MATCHCMD &#39;/&#39; (~[/])* &#39;/&#39; ; </div>
<div class="line">MATCHCMD : &#39;m&#39; ;</div>
</div><!-- fragment --><ul>
<li>パージング例</li>
</ul>
<div class="fragment"><div class="line">$echo &quot;database/book [ age &lt; 22 and year &gt;= 2000 and title =~ m/.*XML.*/ ]&quot; | java -cp &quot;.:../antlr-4.7.1-complete.jar&quot; Prog</div>
<div class="line">| rule: query</div>
<div class="line">| | rule: step</div>
<div class="line">| | | rule: path</div>
<div class="line">| | | | rule: name</div>
<div class="line">| | | | | terminal: &#39;database&#39;</div>
<div class="line">| | | | rule: name</div>
<div class="line">| | | | | terminal: &#39;book&#39;</div>
<div class="line">| | | rule: predicate</div>
<div class="line">| | | | rule: andexpr</div>
<div class="line">| | | | | rule: expr</div>
<div class="line">| | | | | | rule: arithrel</div>
<div class="line">| | | | | | | rule: name</div>
<div class="line">| | | | | | | | terminal: &#39;age&#39;</div>
<div class="line">| | | | | | | terminal: &#39;&lt;&#39;</div>
<div class="line">| | | | | | | rule: number</div>
<div class="line">| | | | | | | | terminal: &#39;22&#39;</div>
<div class="line">| | | | | rule: expr</div>
<div class="line">| | | | | | rule: arithrel</div>
<div class="line">| | | | | | | rule: name</div>
<div class="line">| | | | | | | | terminal: &#39;year&#39;</div>
<div class="line">| | | | | | | terminal: &#39;&gt;=&#39;</div>
<div class="line">| | | | | | | rule: number</div>
<div class="line">| | | | | | | | terminal: &#39;2000&#39;</div>
<div class="line">| | | | | rule: expr</div>
<div class="line">| | | | | | rule: stringrel</div>
<div class="line">| | | | | | | rule: name</div>
<div class="line">| | | | | | | | terminal: &#39;title&#39;</div>
<div class="line">| | | | | | | terminal: &#39;=~&#39;</div>
<div class="line">| | | | | | | terminal: &#39;m/.*XML.*/&#39;</div>
</div><!-- fragment --><hr  />
 <h1>EOF</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon May 10 2021 12:23:16 for asax02.neo by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
