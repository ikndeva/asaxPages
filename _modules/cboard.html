
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cboard &#8212; GridBoard v0.9 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cboard</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf_8</span>
<span class="c1"># 画盤モジュール</span>
<span class="sd">&quot;&quot;&quot;画盤モジュール</span>

<span class="sd">cboard.py</span>
<span class="sd">220815 Created based on board.py</span>
<span class="sd">by Hiroki Arimura, arim@ist.hokudai.ac.jp </span>

<span class="sd">Attributes: </span>

<span class="sd">    DEFAULT_PPT = 720 (int): デフォールトの解像度</span>
<span class="sd">    DEFAULT_LINE_WIDTH = 1 (float): デフォールトの辺幅</span>
<span class="sd">    DEFAULT_COLOR_BORDER_INNER = &#39;red&#39; (str): デフォールトの境界色（内側）</span>
<span class="sd">    DEFAULT_COLOR_BORDER_OUTER = &#39;blue&#39; (str): デフォールトの境界色（外側）</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span> 
<span class="kn">import</span> <span class="nn">copy</span> 
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">cairo</span> 
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="kn">import</span> <span class="nn">common</span> <span class="k">as</span> <span class="nn">com</span>
<span class="kn">import</span> <span class="nn">kwargs</span> <span class="k">as</span> <span class="nn">kw</span>
<span class="kn">import</span> <span class="nn">crtool</span> <span class="k">as</span> <span class="nn">crt</span>
<span class="kn">import</span> <span class="nn">cimage</span> <span class="k">as</span> <span class="nn">cim</span>

<span class="c1"># DEFAULT_PPI = 720 </span>
<span class="c1"># DEFAULT_LINE_WIDTH = 1 </span>
<span class="c1"># DEFAULT_COLOR_BORDER_INNER = &#39;red&#39;</span>
<span class="c1"># DEFAULT_COLOR_BORDER_OUTER = &#39;blue&#39;</span>
<span class="c1"># EMPTY_RECT = ((0,0), (0,0))</span>


<span class="c1">## PARAMS 2022 version</span>
<span class="n">EMPTY_RECT</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">MYCOLS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">DARKCOL</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="c1">#MYCOLS = list(crt.MYCOL.values())</span>
<span class="n">DEFAULT_LINE_WIDTH</span><span class="o">=</span><span class="mi">1</span>

<span class="c1"># 辞書（語彙）</span>

<span class="c1">## 画像サイズ</span>
<span class="n">DISPLAY_SHAPE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;QVGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span>
    <span class="s1">&#39;VGA&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span> 
    <span class="s1">&#39;SVGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> 
    <span class="s1">&#39;XGA&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">),</span> <span class="c1">#default size</span>
    <span class="s1">&#39;WXGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1280</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span> 
    <span class="s1">&#39;UXGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">),</span> 
    <span class="s1">&#39;QXGA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">1536</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">DEFAULT_IMAGE_SIZE</span><span class="o">=</span><span class="s1">&#39;XGA&#39;</span>

<span class="c1"># #constants</span>
<span class="c1"># CMD_MOVE = 0</span>
<span class="c1"># CMD_LINE = 1</span>

<div class="viewcode-block" id="perturb_point"><a class="viewcode-back" href="../cboard.html#cboard.perturb_point">[docs]</a><span class="k">def</span> <span class="nf">perturb_point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_perturb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;与えられた点 (x, y) に対して，幅</span>
<span class="sd">    [(-1)*max_perturb, (+1)*max_perturb] </span>
<span class="sd">    の摂動を与えた点(x1, y1)を返す．</span>
<span class="sd">    Args : </span>
<span class="sd">      x, y (float) : 入力点のx- and y-coordinates．デフォールト値 x = y = 0.0</span>
<span class="sd">    Returns : </span>
<span class="sd">      x1, y1 (float) : 摂動を加えた点のx- and y-coordinates</span>
<span class="sd">    Notes: </span>
<span class="sd">      xとyが省略された老婆は，値0.0, 0.0を中心とした摂動を返す．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_perturb</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;warning: cboard.perturb_point: max_perturb==0.0!&#39;</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">max_perturb</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">max_perturb</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span></div>



<span class="c1">#=====</span>
<span class="c1"># 画盤（board）のクラス: 座標系オブジェクト</span>
<span class="c1">#=====</span>
<span class="c1"># class Board(com.Loggable):</span>
<div class="viewcode-block" id="BoardBase"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase">[docs]</a><span class="k">class</span> <span class="nc">BoardBase</span><span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="n">Loggable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤（board）のクラス: 座標系オブジェクト</span>

<span class="sd">    Attributes: </span>
<span class="sd">        verbose (bool): ログ出力のフラグ</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#board id</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="c1"># dep_init=None, #親クラスLoggableに設定: </span>
                 <span class="c1"># verbose=False, #親クラスLoggableに設定:</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>

<span class="sd">        Args: </span>
<span class="sd">            parent (Board): 自身に設定: 親ボード親オブジェクト</span>
<span class="sd">            shape (vec)   : 自座標系での自身の包含矩形</span>
<span class="sd">            dep_init (int): 親クラスLoggableに設定. 生成時に親+1で指定する．</span>
<span class="sd">            verbose (bool): 親クラスLoggableに設定. ログ出力のフラグ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#引数</span>
        <span class="c1">#親Loggableの初期化</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#初期化</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children_</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># 子のリスト</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ord_</span>   <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># 子ID (親の子リスト中の自身の添字)．外部アクセスに必要．</span>
        <span class="c1">#自身の配置情報</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#自身の変換</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1">#自身の包含矩形.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxes</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1">#デバグ用_元の包含矩形.</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">#=====</span>
    <span class="c1"># キーワード辞書</span>
    <span class="c1">#=====</span>
<div class="viewcode-block" id="BoardBase.vars"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.vars">[docs]</a>    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自身のオブジェクトの属性からなる辞書を返す．</span>
<span class="sd">        その際，未定義（値がNone）の属性はスキップする．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">kw</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="BoardBase.bname"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.bname">[docs]</a>    <span class="k">def</span> <span class="nf">bname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;便利関数．ログ用に，Boardオブジェクトの情報の文字列を返す．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">depth</span><span class="p">:</span> 
            <span class="n">bstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">if</span> <span class="nb">ord</span><span class="p">:</span> 
            <span class="n">bstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">ord_</span> <span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> 
            <span class="n">bstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[&#39;</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="si">}</span><span class="s2">&#39;]&quot;</span>
        <span class="k">return</span> <span class="n">bstr</span></div>

    <span class="c1">#=====</span>
    <span class="c1"># 子のリスト</span>
    <span class="c1">#=====</span>
    
    <span class="c1"># # 基本：子画盤の並びを返す</span>
    <span class="c1"># def children(self):</span>
    <span class="c1">#     &quot;&quot;&quot;子画盤の並び children を返す．</span>
    <span class="c1">#     Returns: </span>
    <span class="c1">#     	list: 子オブジェクトのリスト</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return self.children_  ##ダミー：子クラスでOverrideすること</span>


    <span class="c1"># exp 基本：子を追加する</span>
<div class="viewcode-block" id="BoardBase.put"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;子を追加する．</span>

<span class="sd">        Args: </span>
<span class="sd">            trans (cairo.Matrix) : 自座標における子の配置を指示する変換行列．原点にある子を所望の場所に配置するためのアフィン変換を表す．</span>
<span class="sd">            child (Board): 子として追加するBoardオブジェクト</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_vars_put_</span><span class="p">(</span><span class="n">board</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">kw</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="nb">vars</span><span class="p">(</span><span class="n">board</span><span class="p">),</span>
                              <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span><span class="s1">&#39;verbose&#39;</span><span class="p">])</span>

        <span class="c1">#子の型チェックと親子関係の管理</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inherit_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="c1">#子を追加する</span>
        <span class="n">child</span><span class="o">.</span><span class="n">ord_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span>      <span class="c1">#子ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">trans</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span> <span class="c1">#子リスト</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=&gt; added: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.put(): trans=</span><span class="si">{</span><span class="n">trans</span><span class="si">}</span><span class="s1"> child=</span><span class="si">{</span> <span class="n">child</span> <span class="si">}</span><span class="s1"> with vars=</span><span class="si">{</span> <span class="n">child</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="c1">#for cascade object interface </span></div>

    
    <span class="c1"># 基本：子画盤の並びを返す</span>
    <span class="c1">##Override</span>
<div class="viewcode-block" id="BoardBase.children_indexed"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.children_indexed">[docs]</a>    <span class="k">def</span> <span class="nf">children_indexed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;添字とエントリの対`idx, value`の並び children を返す．</span>
<span class="sd">        現在は，`trans, child = value`である．部分クラスで上書きする．</span>
<span class="sd">        Returns: </span>
<span class="sd">        	list: 子オブジェクトのリスト</span>

<span class="sd">        Notes : </span>
<span class="sd">          読み出し`idx, value = children_indexed()`と書き込み`children_replace(idx, value)`を対にして用いる．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span>  <span class="c1">##ダミー：子クラスでOverrideすること</span></div>

    <span class="c1">##Override</span>
<div class="viewcode-block" id="BoardBase.children_replace"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.children_replace">[docs]</a>    <span class="k">def</span> <span class="nf">children_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;添字とエントリの対`idx, value`の並び children において，</span>
<span class="sd">        idx番目のエントリを`value=(trans, child)`で置換する．部分クラスで上書きする．</span>
<span class="sd">        Returns: </span>
<span class="sd">            (Board): 自分自身．</span>
<span class="sd">        Notes : </span>
<span class="sd">          読み出し`idx, value = children_indexed()`と書き込み`children_replace(idx, value)`を対にして用いる．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">idx</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idx must be nono-None!&#39;</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;pair must be nono-None!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="c1">#=====</span>
    <span class="c1"># 子のリスト</span>
    <span class="c1">#=====</span>

    <span class="c1">#=====</span>
    <span class="c1"># 雑関数</span>
    <span class="c1">#=====</span>

<div class="viewcode-block" id="BoardBase.get_box"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.get_box">[docs]</a>    <span class="k">def</span> <span class="nf">get_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span></div>

    <span class="c1"># exp 基本：配置の計算</span>
<div class="viewcode-block" id="BoardBase.arrange"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.arrange">[docs]</a>    <span class="k">def</span> <span class="nf">arrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;配置を計算する．配置は，ボトムアップに再帰的に計算される．</span>

<span class="sd">        Args: </span>
<span class="sd">        Returns: </span>
<span class="sd">        	rect: 計算済みの自身の包含矩形オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#子供全ての包含長方形を計算する</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span>
        
        <span class="c1">#自身の描画配置情報を得る</span>
        <span class="n">box0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrange_me</span><span class="p">()</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">box0</span><span class="p">)</span> <span class="c1">#包含矩形の更新</span>
        
        <span class="c1"># for idx, pair in enumerate(self.children()):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_indexed</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="s1">&#39;child must be a subclass of BoardBase!: </span><span class="si">{child}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trans</span><span class="p">:</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">crt</span><span class="o">.</span><span class="n">GeoTransform</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;trans must be of crt.GeoTransform: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=&gt; [</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">] calling on </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">-th child=</span><span class="si">{</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
            <span class="c1">#子の再帰処理</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">arrange</span><span class="p">()</span>
                
            <span class="c1"># ##必要なら変換と子を更新する．</span>
            <span class="c1"># trans, child = self.arrange_modify_child(trans, child, child_box)</span>
            <span class="c1"># self.children_replace(idx=idx, value=(trans, child))</span>
            <span class="c1"># ##子リストのidx番目のエントリを上書き</span>
            
            <span class="c1">#自身の包含矩形の更新</span>
            <span class="k">if</span> <span class="n">child_box</span><span class="p">:</span>
                <span class="n">child_box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">child_box</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
                <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">child_box</span><span class="p">)</span> <span class="c1">#包含矩形の更新</span>
            
        <span class="c1"># self.box_self = boxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxes</span> <span class="o">=</span> <span class="n">boxes</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrange_self_transform</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:trans:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">: trans=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#自身の描画配置情報を得る</span>
        <span class="c1">#包含矩形の処理は自身の責任で行う．</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrange_me_post</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange()=&gt; box=</span><span class="si">{</span> <span class="n">boxes</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> </div>

    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="BoardBase.arrange_me"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.arrange_me">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の座標系で配置を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">box</span> </div>

    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="BoardBase.arrange_me_post"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.arrange_me_post">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_me_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の座標系で配置を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">box</span> </div>
        
    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="BoardBase.arrange_self_transform"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.arrange_self_transform">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_self_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;アンカー情報から，変換と包含矩形を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#identity</span>
        <span class="k">return</span> <span class="n">trans</span><span class="p">,</span> <span class="n">box</span></div>
        
    <span class="c1">#Override</span>
<div class="viewcode-block" id="BoardBase.arrange_modify_child"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.arrange_modify_child">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_modify_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">child_box</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;変換と，子ボード，子の包含矩形から，更新した変換と子ボードを返す．上書きすること．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">##必要ならここで何かする．とりあえず，そのまま返す．</span>
        <span class="k">return</span> <span class="n">trans</span><span class="p">,</span> <span class="n">child</span></div>

    <span class="c1">#=====</span>
    <span class="c1"># 描画</span>
    <span class="c1">#=====</span>
<div class="viewcode-block" id="BoardBase.draw"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;トップダウンに画像を描画する．</span>
<span class="sd">        Args: </span>
<span class="sd">            trans (crt.GeoTransform) : 空間変換</span>
<span class="sd">            pm0 (pim.ImageBoard) : 基本描画のプリミティブボード</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1">## 自分の空間を開く</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1">##self</span>
        <span class="c1">## 自身の変換を適用する</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_apply_trans</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:draw:self:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">: apply trans_self=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1">#必要なら自分の描画を行う</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_me</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        
        <span class="c1">#子の描画を行う</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_indexed</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw: child must be a subclass of BoardBase!: </span><span class="si">{</span><span class="n">child</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">+</span>
                       <span class="sa">f</span><span class="s1">&#39;: children_=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="n">cr</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>    <span class="c1">## 子の空間を開く</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_apply_trans</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span> <span class="c1">## 変換を適用する</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- @debug:draw:child:</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">: apply trans=</span><span class="si">{</span><span class="n">trans</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span> <span class="c1">## 子の空間を閉じる</span>

        <span class="c1">#必要なら自分の描画を行う</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_me_post</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

        <span class="c1">## 自分の空間を閉じる</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>  <span class="c1">##self</span>

        <span class="c1">## debug: 包含矩形を描画する</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;boundingbox&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">crt</span><span class="o">.</span><span class="n">isBoxOrPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@option boundingbox: draw my box=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_perturbed_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>

        <span class="c1"># debug: 自分の原点位置をマーカーで描画する．</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;show_origin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_draw_marker_cross</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> 
                                     <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">return</span></div>

    <span class="c1"># 派生：Override</span>
<div class="viewcode-block" id="BoardBase.draw_me"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.draw_me">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の描画を行う．子孫クラスでオーバーライドすること．</span>
<span class="sd">        Args: </span>
<span class="sd">            cr (Cairo.Context) : Cairoの文脈オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me()...&#39;</span><span class="p">)</span>
        <span class="c1">## ここでcontext crに何か描く．</span>
        <span class="k">return</span> </div>

    <span class="c1"># 派生：Override</span>
<div class="viewcode-block" id="BoardBase.draw_me_post"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.draw_me_post">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の描画を行う．子孫クラスでオーバーライドすること．</span>
<span class="sd">        Args: </span>
<span class="sd">            cr (Cairo.Context) : Cairoの文脈オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me()...&#39;</span><span class="p">)</span>
        <span class="c1">## ここでcontext crに何か描く．</span>
        <span class="k">return</span></div>

    <span class="c1">#=====</span>
    <span class="c1"># おまけ関数．drawの副関数</span>
    <span class="c1">#=====</span>
<div class="viewcode-block" id="BoardBase.draw_perturbed_box"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.draw_perturbed_box">[docs]</a>    <span class="k">def</span> <span class="nf">draw_perturbed_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_perturb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;位置を</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="n">context</span> 
        <span class="n">box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">())</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">## 色を選ぶ</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">MYCOLS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">## 色</span>
        <span class="n">rgb_alpha</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="c1">## 色の透明度</span>
        <span class="c1"># rgb_alpha = 0.5</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">:</span> 
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">MYCOLS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">MYCOLS</span><span class="p">)]</span>  <span class="c1">## 色</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;debug: self.depth=None at </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">## 位置を微小変動させる</span>
        <span class="n">max_perturb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;max_perturb&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">DEFAULT_LINE_WIDTH</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">max_perturb</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;max_perturb=</span><span class="si">{</span><span class="n">max_perturb</span><span class="si">}</span><span class="s1"> must be defined!&#39;</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">max_perturb</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">max_perturb</span> 
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_rectangle</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                         <span class="n">source_rgb</span><span class="o">=</span><span class="n">rgb</span><span class="p">,</span>
                         <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
        
        <span class="c1">## キャプション</span>
        <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span>
        <span class="n">fsize</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">fmargin</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">fsize</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">cr_text_extent</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">tx</span> <span class="o">+</span> <span class="n">fmargin</span><span class="p">,</span> <span class="n">ty</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">dy</span> <span class="o">+</span> <span class="n">fmargin</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">fsize</span><span class="p">,</span> 
                    <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>

        <span class="k">return</span> </div>

    <span class="c1">#==========</span>
    <span class="c1"># 座標系</span>
    <span class="c1">#==========</span>
<div class="viewcode-block" id="BoardBase.get_anchor_point"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.get_anchor_point">[docs]</a>    <span class="k">def</span> <span class="nf">get_anchor_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;アンカー指定から，自身の包含矩形上の対応する点を返す．</span>
<span class="sd">        Args : </span>
<span class="sd">          anchor_x (str) : 横方向の位置指示 in (left, middle, right)</span>
<span class="sd">          anchor_y (str) : 縦方向の位置指示 in (top, middle, bottom, above, below)</span>
<span class="sd">          anchor (str) : 代替の位置指示．内容に応じて横または縦の位置表示として用いる．ただし，anchor_xまたはanchor_yを優先し，両方設定しようとするとエラーを呼ぶ．</span>

<span class="sd">        Returns : </span>
<span class="sd">          (tuple(float, float)) : アンカー点(x,y)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## exp: アンカー情報を用いて，変換transを求める</span>
        
        <span class="c1"># アンカーキーワードから，アンカー比率を返す．</span>
        <span class="n">ratio_x</span><span class="p">,</span> <span class="n">ratio_y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_anchor_ratio</span><span class="p">(</span><span class="n">anchor_x</span><span class="o">=</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="n">anchor_y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;self.box_self is None!&#39;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_point_by_anchor_ratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_self</span><span class="p">,</span> <span class="n">ratio_x</span><span class="o">=</span><span class="n">ratio_x</span><span class="p">,</span> <span class="n">ratio_y</span><span class="o">=</span><span class="n">ratio_y</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
                   <span class="sa">f</span><span class="s1">&#39;x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> and y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1"> must be numbers&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

    <span class="k">pass</span> <span class="c1">## end class BoardBase </span>


    <span class="c1">#==========</span>
    <span class="c1"># 外部アクセス: exp</span>
    <span class="c1">#==========</span>
<div class="viewcode-block" id="BoardBase.relative_apath_get"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.relative_apath_get">[docs]</a>    <span class="k">def</span> <span class="nf">relative_apath_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hgt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;基準オブジェクトから自身へのアクセスパス（子添字列）を返す．</span>
<span class="sd">        Args: </span>
<span class="sd">          top (BoardBase) : 基準オブジェクト．このBoardBaseか根へ到達すると停止する．</span>
<span class="sd">        Returns : </span>
<span class="sd">          (list(int)) : 成功すれば，基準オブジェクトから自身へのアクセスパス（子添字列）．失敗すればNone</span>
<span class="sd">        Note: </span>
<span class="sd">          仮定：self.depth==Noneの場合は，全ての子孫のdepth==None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">top</span><span class="o">!=</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;top must not be None!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">apath</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">apath</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">apath</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">))</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">==</span><span class="n">top</span><span class="p">:</span> 
            <span class="n">apath</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1">#return None</span>
            <span class="k">return</span> <span class="n">apath</span>
        <span class="k">elif</span> <span class="n">pa</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">None</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">relative_apath_get</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ord_</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="n">apath</span><span class="p">,</span> 
                                      <span class="n">hgt</span><span class="o">=</span><span class="n">hgt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BoardBase.relative_apath_to_tpath"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.relative_apath_to_tpath">[docs]</a>    <span class="k">def</span> <span class="nf">relative_apath_to_tpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;点p=(x,y)を，アクセスパスapath=((), ..., ())</span>
<span class="sd">        Args: </span>
<span class="sd">          p (tuple) : 点p=(x,y) or 矩形p=(x0, y0, x1, y1)</span>
<span class="sd">          apath (list) : (ord, board)のリスト．最初の要素はord=None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;debug: call apath=</span><span class="si">{</span><span class="n">apath</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> tpath=</span><span class="si">{</span><span class="n">tpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tpath</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">tpath</span><span class="o">=</span><span class="p">[]</span>
            
        <span class="k">if</span> <span class="n">apath</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">apath</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">tpath</span>
        
        <span class="n">node</span><span class="p">,</span> <span class="nb">ord</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;node must be of BoardBase type!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">ord</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">debug: last element!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tpath</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">ord</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children_</span><span class="p">)):</span>
            <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ord=</span><span class="si">{</span><span class="nb">ord</span><span class="si">}</span><span class="s1"> is out of range!:&#39;</span><span class="o">+</span>
                      <span class="sa">f</span><span class="s1">&#39; num children=</span><span class="si">{</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children_</span><span class="p">[</span><span class="nb">ord</span><span class="p">]</span>
            <span class="n">tpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">debug: visit </span><span class="si">{</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">bname</span><span class="p">(),</span> <span class="nb">ord</span><span class="p">)</span> <span class="si">}</span><span class="s1"> =&gt; </span><span class="si">{</span> <span class="n">trans</span> <span class="si">}</span><span class="s1"> tpath=</span><span class="si">{</span><span class="n">tpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">apath1</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">relative_apath_to_tpath</span><span class="p">(</span><span class="n">apath</span><span class="o">=</span><span class="n">apath1</span><span class="p">,</span> <span class="n">tpath</span><span class="o">=</span><span class="n">tpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BoardBase.relative_apply_transform_by_apath"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.relative_apply_transform_by_apath">[docs]</a>    <span class="k">def</span> <span class="nf">relative_apply_transform_by_apath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;点p=(x,y)を，アクセスパスapath=((), ..., ())</span>
<span class="sd">        Args: </span>
<span class="sd">          p (tuple) : 点p=(x,y) or 矩形p=(x0, y0, x1, y1)</span>
<span class="sd">          apath (list) : (ord, board)のリスト．最初の要素はord=None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">apath</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- empty list; It must not reach!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="nb">ord</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;x must be of BoardBase type!&#39;</span><span class="p">)</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="bp">self</span><span class="o">==</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;condition self==apath[0][0] must hold!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">debug: relative_transform_point_by_apath: p=</span><span class="si">{</span> <span class="n">p</span> <span class="si">}</span><span class="se">\t</span><span class="s1">apath[0]=</span><span class="si">{</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">ord</span><span class="p">)</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">ord</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- last element; return p=</span><span class="si">{</span> <span class="n">p</span> <span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">p</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">ord</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">children_</span><span class="p">)):</span>
                <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ord=</span><span class="si">{</span><span class="nb">ord</span><span class="si">}</span><span class="s1"> is out of range!:&#39;</span><span class="o">+</span>
                          <span class="sa">f</span><span class="s1">&#39; num children=</span><span class="si">{</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">children_</span><span class="p">[</span><span class="nb">ord</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">crt</span><span class="o">.</span><span class="n">isBoxOrPoint</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">p1</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">apply_point</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="c1"># p1 = crt.apply_trans_point(p, trans=trans)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
                        <span class="n">p1</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
                        <span class="c1"># p1 = crt.box_apply_trans(p, trans=trans)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1"> must be either a point or a box!&#39;</span><span class="p">)</span>
                <span class="n">apath1</span> <span class="o">=</span> <span class="n">apath</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">relative_apply_transform_by_apath</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">apath1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>
   
<div class="viewcode-block" id="BoardBase.relative_transform"><a class="viewcode-back" href="../cboard.html#cboard.BoardBase.relative_transform">[docs]</a>    <span class="k">def</span> <span class="nf">relative_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自身の子孫であるBoardBaseオブジェクトtargetの座標系における，</span>
<span class="sd">        点p=(x,y)の局所座標を返す，</span>
<span class="sd">        Args: </span>
<span class="sd">          target (BoardBase) : 自身の子孫であるBoardBaseオブジェクト</span>
<span class="sd">          p (tuple) : 点p=(x,y)</span>
<span class="sd">        Notes: </span>
<span class="sd">          apath (list) は，selfからtargetへのアクセスパスであり，</span>
<span class="sd">          (board, ord)のリスト．</span>
<span class="sd">          - 末尾以外の要素boardについて，その子はboard.chidren_[ord]であり，</span>
<span class="sd">          - 末尾要素boardに対してはord=Noneである．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">apath</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">relative_apath_get</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;relative_transform_point: apath=</span><span class="si">{</span> <span class="p">[</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">ord</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">ord</span> <span class="ow">in</span> <span class="n">apath</span> <span class="p">]</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_apply_transform_by_apath</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">apath</span><span class="o">=</span><span class="n">apath</span><span class="p">,</span>
                                                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div></div>
    
<span class="c1">#=====</span>
<span class="c1"># ボードの実装クラス</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="AnchorBoard"><a class="viewcode-back" href="../cboard.html#cboard.AnchorBoard">[docs]</a><span class="k">class</span> <span class="nc">AnchorBoard</span><span class="p">(</span><span class="n">BoardBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤（board）のクラス．BoardBaseのラッパー．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>

<span class="sd">        Args : </span>
<span class="sd">          anchor_x (str) : 横方向の位置指示 in (left, middle, right)</span>
<span class="sd">          anchor_y (str) : 縦方向の位置指示 in (top, middle, bottom, above, below)</span>
<span class="sd">          anchor (str) : 代替の位置指示．内容に応じて横または縦の位置表示として用いる．ただし，anchor_xまたはanchor_yを優先し，両方設定しようとするとエラーを呼ぶ．</span>
<span class="sd">          **kwargs : 他のキーワード引数．上位クラスに渡される．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#引数</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_x</span> <span class="o">=</span> <span class="n">anchor_x</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_y</span> <span class="o">=</span> <span class="n">anchor_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span>
        <span class="c1">#内部変数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_trans</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="AnchorBoard.arrange_self_transform"><a class="viewcode-back" href="../cboard.html#cboard.AnchorBoard.arrange_self_transform">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_self_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box_native</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;アンカー情報から，変換と包含矩形を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="c1">## exp: アンカー情報を用いて，変換transを求める</span>
        
        <span class="c1"># アンカーキーワードから，アンカー比率を返す．</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_x</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_y</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">box_native</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_anchor_ratio</span><span class="p">(</span><span class="n">anchor_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
        
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_point_by_anchor_ratio</span><span class="p">(</span><span class="n">box_native</span><span class="p">,</span>
                                                 <span class="n">ratio_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span>
                                                 <span class="n">ratio_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span><span class="p">)</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span>
                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange_me_post:&#39;</span><span class="o">+</span>
                       <span class="sa">f</span><span class="s1">&#39; x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> and y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1"> must be numbers&#39;</span><span class="p">)</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="c1">##新しい変換</span>
            
            <span class="c1">##新しい変換で包含矩形を変換する</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_apply_trans</span><span class="p">(</span><span class="n">box_native</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:arrange_self_transform:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">: ratio=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="si">}</span><span class="s1"> =&gt; x,y=</span><span class="si">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="si">}</span><span class="s1"> trans=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">: box0=</span><span class="si">{</span><span class="n">box_native</span><span class="si">}</span><span class="s1"> =&gt; box=</span><span class="si">{</span><span class="n">box</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">trans</span><span class="p">,</span> <span class="n">box</span></div>

    <span class="k">pass</span> <span class="c1">##class AnchorBoard</span></div>
        
<span class="c1">#=====</span>
<span class="c1"># ボードのインタフェースのクラス</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="Board"><a class="viewcode-back" href="../cboard.html#cboard.Board">[docs]</a><span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">AnchorBoard</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;画盤（board）のクラス．BoardBaseのラッパー．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>

<span class="sd">        Args : </span>
<span class="sd">          **kwargs : 他のキーワード引数．上位クラスに渡される．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#引数</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<span class="c1">#======</span>
<span class="c1">#基盤画像系: exp </span>
<span class="c1">#======</span>
<div class="viewcode-block" id="Canvas"><a class="viewcode-back" href="../cboard.html#cboard.Canvas">[docs]</a><span class="k">class</span> <span class="nc">Canvas</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;トップレベルのボードのクラス．描画のためのCairoのSurfaceを保持する．</span>
<span class="sd">    描画対象のすべての要素（ボード）は，本オブジェクトの子孫として保持する．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># background (string): 背景色．デバッグ用．default=&#39;skyblue&#39;, #debug</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">imgtype</span><span class="o">=</span><span class="n">cairo</span><span class="o">.</span><span class="n">FORMAT_ARGB32</span><span class="p">,</span> <span class="c1">#cairoのSurface format</span>
                 <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span>   <span class="c1">#出力ファイルフォーマット（拡張子 pdf, png）</span>
                 <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>  <span class="c1">#出力ファイル名（拡張子を除く）</span>
                 <span class="n">imagesize</span><span class="o">=</span><span class="s1">&#39;XGA&#39;</span><span class="p">,</span><span class="c1">#初期の画像サイズ</span>
                 <span class="n">portrait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#画像サイズが縦長か？</span>
                 <span class="c1">## for debugging</span>
                 <span class="n">boundingbox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1">#デバッグ用: 包含矩形のデバッグ出力をする</span>
                 <span class="n">max_perturb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1">#デバッグ用: </span>
                 <span class="c1"># show_origin=None,  #デバッグ用: </span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;トップレベルのボードを生成する．描画のためのCairoのSurfaceを保持する．</span>

<span class="sd">        Args: </span>
<span class="sd">          imgtype (cairo.Format) : Surfaceフォーマット (default: cairo.FORMAT_ARGB32)</span>
<span class="sd">          format (str) : 出力ファイルフォーマット（拡張子 pdf, png）default: &quot;pdf&quot;</span>
<span class="sd">          outfile (str) : 出力ファイル名（拡張子を除く）default: &quot;out&quot;</span>
<span class="sd">          imagesize (str) : 初期の画像サイズ. default: &#39;XGA&#39;        </span>
<span class="sd">          verbose (bool): ログ出力のフラグ．default=False    </span>
<span class="sd">          portrait (bool) : 画像サイズが縦長か？</span>
<span class="sd">          boundingbox (bool)  : デバッグ用: 包含矩形のデバッグ出力をする</span>
<span class="sd">          max_perturb (float) : デバッグ用: 包含矩形の摂動幅</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#基礎クラスの生成子</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dep_init</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
        <span class="c1">#パラメータ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgtype</span>   <span class="o">=</span> <span class="n">imgtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span>    <span class="o">=</span> <span class="nb">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span>   <span class="o">=</span> <span class="n">outfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="o">=</span> <span class="n">imagesize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">portrait</span>  <span class="o">=</span> <span class="n">portrait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundingbox</span> <span class="o">=</span> <span class="n">boundingbox</span> <span class="c1">#fetchで子孫からアクセス</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_perturb</span> <span class="o">=</span> <span class="n">max_perturb</span> <span class="c1">#fetchで子孫からアクセス</span>
        <span class="c1"># self.show_origin = show_origin #fetchで子孫からアクセス</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">##属性</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pim</span>    <span class="o">=</span> <span class="kc">None</span>   <span class="c1">#基礎画像オブジェクト．遅延生成</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.verbose = verbose </span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): vars=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#基底描画オブジェクトの生成</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">:</span> <span class="c1">#cairoのformatが与えられていたら，直ちに基底画像pimを生成</span>
            <span class="c1">#画像フォーマット</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;format must be defined!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;.create_pim: format=</span><span class="si">{</span> <span class="nb">format</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1">#display_sizeの設定</span>
            <span class="c1">##画像サイズ</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="ow">in</span> <span class="n">DISPLAY_SHAPE</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span> <span class="o">=</span> <span class="n">DEFAULT_IMAGE_SIZE</span>
            <span class="n">xsize_</span><span class="p">,</span> <span class="n">ysize_</span> <span class="o">=</span> <span class="n">DISPLAY_SHAPE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesize</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">portrait</span><span class="p">:</span> <span class="c1">#縦長</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">ysize_</span><span class="p">,</span> <span class="n">xsize_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#横長</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">xsize_</span><span class="p">,</span> <span class="n">ysize_</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">pim</span> <span class="o">=</span> <span class="n">cim</span><span class="o">.</span><span class="n">ImageBoard</span><span class="p">(</span>
                <span class="n">dep_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> 
                <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> 
                <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                <span class="n">display_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">display_size</span><span class="p">,</span> 
                <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> 
            <span class="p">)</span>  <span class="c1">##ImageBoardの生成</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pim</span><span class="o">.</span><span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> 
        
    <span class="c1">#=====</span>
    <span class="c1"># 基底描画系の生成</span>
    <span class="c1">#=====</span>

<div class="viewcode-block" id="Canvas.canvas_size"><a class="viewcode-back" href="../cboard.html#cboard.Canvas.canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span></div>

    <span class="c1"># 基本：画像を表示する</span>
<div class="viewcode-block" id="Canvas.show"><a class="viewcode-back" href="../cboard.html#cboard.Canvas.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noshow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;配置と描画を行ない，画像をディスプレイに表示する．</span>
<span class="sd">        次の手順で描画する．</span>

<span class="sd">        - ステップ1: 再帰的に子オブジェクトへ arrange() 命令を送り，ボトムアップに配置の包含矩形 box を計算する</span>
<span class="sd">        - ステップ2: 包含矩形情報 box を元に，self.create_pim() 命令を発行して，pillowの画像盤 self.pim を生成する．</span>
<span class="sd">        - ステップ3: 再帰的に draw() 命令を発行して，トップダウンに描画を行う</span>
<span class="sd">        - ステップ4: 自身のもつpillowオブジェクト self.pimに show() 命令を送り，画像を表示する</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.show(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#ステップ1: ボトムアップに配置を計算する</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrange</span><span class="p">()</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s1">&#39;self.shape_pt must be defined!&#39;</span><span class="p">)</span>

        <span class="c1">#ステップ2: トップダウンに描画を行う</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pim</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        
        <span class="c1">#ステップ3: 画像を表示する</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pim</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">noshow</span><span class="o">=</span><span class="n">noshow</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>  <span class="c1">##pilimage.ImageBoard</span>
        <span class="k">return</span></div>

    <span class="c1"># ImageBoardオブジェクトの返却</span>
<div class="viewcode-block" id="Canvas.get_image_board"><a class="viewcode-back" href="../cboard.html#cboard.Canvas.get_image_board">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_board</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;ImageBoardオブジェクトを返す．&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pim</span>  <span class="c1">##ImageBoardオブジェクト</span></div>
            
    <span class="c1"># 画像をファイルに保存する</span>
<div class="viewcode-block" id="Canvas.save"><a class="viewcode-back" href="../cboard.html#cboard.Canvas.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;imgfile: 保存する画像ファイルの名前．&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">imgfile</span><span class="o">=</span><span class="n">imgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span></div></div>

<span class="c1">#=====</span>
<span class="c1"># 画盤（board）のクラス: 座標系オブジェクト</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="AnchorWrapper"><a class="viewcode-back" href="../cboard.html#cboard.AnchorWrapper">[docs]</a><span class="k">class</span> <span class="nc">AnchorWrapper</span><span class="p">(</span><span class="n">BoardBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;アンカーオブジェクトのクラス</span>

<span class="sd">    Attributes: </span>
<span class="sd">      anchor_info (dict) : 下記の属性をもつ辞書</span>
<span class="sd">      anchor_x (str) : x方向のアンカー文字列．</span>
<span class="sd">      anchor_y (str) : y方向のアンカー文字列．</span>
<span class="sd">      anchor (str) : 代替のアンカー文字列．anchor_xとanchor_yが指定されていない時に，内容に応じて指定に使う．</span>

<span class="sd">    Example : </span>
<span class="sd">    	キー`anchor_x`と`anchor_y`の値のアンカー文字列は，それぞれ，次の辞書`ALIGN_X`と`ALIGN_Y`のキーである．各キーの辞書中の値それぞれは，正規矩形 `[0,1]x[0,1]`の周上の点を表す．</span>
<span class="sd">    	::</span>
<span class="sd">            ALIGN_X = { </span>
<span class="sd">		&#39;left&#39;:0.0, &#39;center&#39;:0.5, &#39;right&#39;:1.0, </span>
<span class="sd">	    }</span>
<span class="sd">            ALIGN_Y = { </span>
<span class="sd">		&#39;top&#39;:0.0, &#39;middle&#39;: 0.5, &#39;bottom&#39;:1.0, </span>
<span class="sd">    		&#39;mid&#39;: 0.5,  &#39;bot&#39; : 1.0, &#39;above&#39;:0.0, &#39;below&#39;: 1.0, #代替キー</span>
<span class="sd">    	    }</span>
<span class="sd">            DEFAULT_ALIGN_RATIO_X = 0.0</span>
<span class="sd">            DEFAULT_ALIGN_RATIO_Y = 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>
<span class="sd">        Args : </span>
<span class="sd">          anchor_x (str) : 横方向の位置指示 in (left, middle, right)</span>
<span class="sd">          anchor_y (str) : 縦方向の位置指示 in (top, middle, bottom, above, below)</span>
<span class="sd">          anchor (str) : 代替の位置指示．内容に応じて横または縦の位置表示として用いる．ただし，anchor_xまたはanchor_yを優先し，両方設定しようとするとエラーを呼ぶ．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#親の初期化</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#初期化</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;anchor&#39;</span> <span class="p">:</span> <span class="n">anchor</span><span class="p">,</span> 
            <span class="s1">&#39;anchor_x&#39;</span> <span class="p">:</span> <span class="n">anchor_x</span><span class="p">,</span> 
            <span class="s1">&#39;anchor_y&#39;</span> <span class="p">:</span> <span class="n">anchor_y</span><span class="p">,</span> 
        <span class="p">}</span> <span class="c1">## for debugging </span>

        <span class="c1"># アンカーキーワードから，アンカー比率を返す．</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_anchor_ratio</span><span class="p">(</span><span class="n">anchor_x</span><span class="o">=</span><span class="n">anchor_x</span><span class="p">,</span> <span class="n">anchor_y</span><span class="o">=</span><span class="n">anchor_y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># exp 基本：子を追加する</span>
<div class="viewcode-block" id="AnchorWrapper.put"><a class="viewcode-back" href="../cboard.html#cboard.AnchorWrapper.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;子を追加する．`self.put(child)`のように，`trans`を指定せずに使う．</span>

<span class="sd">        Args: </span>
<span class="sd">            child (Board): 子として追加するBoardオブジェクト</span>
<span class="sd">            trans (cairo.Matrix) : 無視される</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#もしまだ子をもたなければ，子を追加する</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=&gt; added </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.put(): trans=</span><span class="si">{</span><span class="n">trans</span><span class="si">}</span><span class="s1"> child=</span><span class="si">{</span> <span class="n">child</span> <span class="si">}</span><span class="s1"> with vars=</span><span class="si">{</span> <span class="n">child</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="AnchorWrapper.arrange_modify_child"><a class="viewcode-back" href="../cboard.html#cboard.AnchorWrapper.arrange_modify_child">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_modify_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">child_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;クラス`Board`の関数`arrange`のフック関数．利用者が上書きして用いる．</span>

<span class="sd">        * 変換と，子ボード，子の包含矩形`trans, child, child_box`から，更新した変換と子ボード`trans, child`を返す．</span>
<span class="sd">        * クラス`Board`の同名の関数を上書きし，関数`arrange`からフックとして呼び出され，変換と子の対を修正するのに用いられる．</span>

<span class="sd">        Args : </span>
<span class="sd">          trans (crtool.GeoTrans) : 現在の子の変換オブジェクト</span>
<span class="sd">          child (Board) : 現在の子ボード</span>
<span class="sd">          child_box (tuple()) : 現在の子の包含矩形(x0, y0, x1, y1)</span>

<span class="sd">        Returns : </span>
<span class="sd">          (crtool.GeoTrans, Board) : 新しい変換と子ボード`trans, child`</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## exp: アンカー情報を用いて，変換transを求める        </span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">get_point_by_anchor_ratio</span><span class="p">(</span><span class="n">child_box</span><span class="p">,</span>
                                             <span class="n">ratio_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span>
                                             <span class="n">ratio_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange_me_post:&#39;</span><span class="o">+</span>
                   <span class="sa">f</span><span class="s1">&#39; x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> and y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1"> must be numbers&#39;</span><span class="p">)</span>
        <span class="c1">##新しい変換で上書き</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="c1">##新しい変換</span>
        <span class="k">return</span> <span class="n">trans</span><span class="p">,</span> <span class="n">child</span></div>

    <span class="k">pass</span></div>

<span class="c1">#=====</span>
<span class="c1"># 配置ボードのクラス</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="GridLocator"><a class="viewcode-back" href="../cboard.html#cboard.GridLocator">[docs]</a><span class="k">class</span> <span class="nc">GridLocator</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;アンカーオブジェクトのクラス</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">num_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">num_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>
<span class="sd">        Args : </span>
<span class="sd">          num_x (int) : x方向のセルの個数</span>
<span class="sd">          num_y (int) : y方向のセルの個数</span>
<span class="sd">          margin (float) : セルとセルの間の余白．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#親の初期化</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#初期化</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="n">margin</span>
        <span class="c1">#作業変数</span>
        <span class="c1">## Noneで埋められたサイズ(num_x x num_y)の2次元配列で初期化する</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
        <span class="k">return</span>

<div class="viewcode-block" id="GridLocator.get_shape"><a class="viewcode-back" href="../cboard.html#cboard.GridLocator.get_shape">[docs]</a>    <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;格子の形状 `(num_x, num_y)`を返す．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span></div>

    <span class="c1"># 基本：子画盤の並びを返す</span>
    <span class="c1">##Override</span>
<div class="viewcode-block" id="GridLocator.children_indexed"><a class="viewcode-back" href="../cboard.html#cboard.GridLocator.children_indexed">[docs]</a>    <span class="k">def</span> <span class="nf">children_indexed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;添字とエントリの対`idx, value`の並び children を返す．実際にはiteratorを返す．</span>
<span class="sd">        現在は，`trans, child = value`である．</span>
<span class="sd">        Returns: </span>
<span class="sd">        	list: 添字とエントリの対`idx, value`のリスト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">##ダミー：子クラスでOverrideすること</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;shape[0]=</span><span class="si">{</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> must be int!: shape=</span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;shape[1]=</span><span class="si">{</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> must be int!: shape=</span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">yield</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span></div>

    <span class="c1">##Override</span>
<div class="viewcode-block" id="GridLocator.children_replace"><a class="viewcode-back" href="../cboard.html#cboard.GridLocator.children_replace">[docs]</a>    <span class="k">def</span> <span class="nf">children_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;添字とエントリの対`idx, value`の並び children において，</span>
<span class="sd">        idx番目のエントリを`value=(trans, child)`で置換する．</span>
<span class="sd">        Returns: </span>
<span class="sd">            (Board): 自分自身．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">idx</span> <span class="o">!=</span> <span class="kc">None</span>
                   <span class="ow">and</span> <span class="n">com</span><span class="o">.</span><span class="n">is_sequence_type</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">elemtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span>
                   <span class="sa">f</span><span class="s1">&#39;idx=</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1"> must be nono-None!&#39;</span><span class="p">)</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">None</span>
                   <span class="ow">and</span> <span class="n">com</span><span class="o">.</span><span class="n">is_sequence_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span>
                   <span class="sa">f</span><span class="s1">&#39;value=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> must be nono-None!&#39;</span><span class="p">)</span>
        <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># exp 基本：子を追加する</span>
<div class="viewcode-block" id="GridLocator.put"><a class="viewcode-back" href="../cboard.html#cboard.GridLocator.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;子を追加する．</span>

<span class="sd">        Args: </span>
<span class="sd">          child (Board): 子として追加するBoardオブジェクト</span>
<span class="sd">          i (int) : x方向のセル添字</span>
<span class="sd">          j (int) : y方向のセル添字</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#配列に入れる</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">shape0</span><span class="p">,</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="n">grid_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">shape0</span><span class="p">:</span> 
            <span class="n">shape0</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">##サイズは添字より一つ大きい</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">shape1</span><span class="p">:</span>
            <span class="n">shape1</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">##サイズは添字より一つ大きい</span>
        <span class="k">if</span> <span class="n">shape0</span> <span class="o">&gt;</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">shape1</span> <span class="o">&gt;</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1">#コピーする</span>
            <span class="n">grid_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">shape0</span><span class="p">,</span> <span class="n">shape1</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">grid_new</span><span class="p">[</span><span class="n">i_</span><span class="p">,</span> <span class="n">j_</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">i_</span><span class="p">,</span> <span class="n">j_</span><span class="p">]</span>
        
        <span class="c1">#子の型チェックと親子関係の管理</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inherit_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="c1">#新しい要素を入れる</span>
        <span class="n">grid_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">ord_</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid_new</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=&gt; added </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.put(): i=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> j=</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> child=</span><span class="si">{</span> <span class="n">child</span> <span class="si">}</span><span class="s1"> with vars=</span><span class="si">{</span> <span class="n">child</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1">#==========</span>
    <span class="c1"># ボードの配置</span>
    <span class="c1">#==========</span>
<div class="viewcode-block" id="GridLocator.arrange"><a class="viewcode-back" href="../cboard.html#cboard.GridLocator.arrange">[docs]</a>    <span class="k">def</span> <span class="nf">arrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;配置を計算する．配置は，ボトムアップに再帰的に計算される．</span>
<span class="sd">        Args: </span>
<span class="sd">        Returns: </span>
<span class="sd">        	rect: 計算済みの自身の包含矩形オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#1度目の子の巡回: 各子供の包含長方形を計算する</span>
        <span class="n">maxlen_x</span><span class="p">,</span> <span class="n">maxlen_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">maxnum_x</span><span class="p">,</span> <span class="n">maxnum_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_indexed</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BoardBase</span><span class="p">),</span>
                       <span class="s1">&#39;child must be a subclass of BoardBase!: </span><span class="si">{child}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#子の型チェック</span>
            <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">trans</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">crt</span><span class="o">.</span><span class="n">GeoTransform</span><span class="p">),</span>
                       <span class="sa">f</span><span class="s1">&#39;trans must be of crt.GeoTransform: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=&gt; [</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">] calling on </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">-th child=</span><span class="si">{</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
            <span class="c1">#子の再帰処理</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">arrange</span><span class="p">()</span>
            
            <span class="c1">## 縦横の最大値</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_normalize</span><span class="p">(</span><span class="n">child_box</span><span class="p">)</span> 
            <span class="n">maxlen_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen_x</span><span class="p">,</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
            <span class="n">maxlen_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen_y</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:GridLocator: child_box=</span><span class="si">{</span> <span class="n">child_box</span> <span class="si">}</span><span class="s1"> =&gt; maxlen=</span><span class="si">{</span><span class="n">maxlen_x</span><span class="p">,</span> <span class="n">maxlen_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1">## 添字の最大値</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="n">maxnum_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxnum_x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">maxnum_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxnum_y</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxnum_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxnum_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:GridLocator: 1st-loop end =&gt; maxlen=</span><span class="si">{</span><span class="n">maxlen_x</span><span class="p">,</span> <span class="n">maxlen_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#2度目の子の巡回: 各子供の包含長方形を計算する</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_indexed</span><span class="p">():</span>
            <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxlen_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">maxlen_y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">j</span> 
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">maxlen_x</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">maxlen_y</span>
            <span class="n">trans_new</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y0</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:GridLocator: ij=</span><span class="si">{</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="si">}</span><span class="s1"> x0,y0=</span><span class="si">{</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="si">}</span><span class="s1"> x1,y1=</span><span class="si">{</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="si">}</span><span class="s1">, trans_new=</span><span class="si">{</span><span class="n">trans_new</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children_replace</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="n">trans_new</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span>
            <span class="n">child_box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
            <span class="c1">#child_box = crt.box_apply_trans(child_box, trans=trans)</span>
            <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">child_box</span><span class="p">)</span> <span class="c1">#包含矩形の更新</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="o">=</span> <span class="n">boxes</span>

        <span class="c1">#自身の描画配置情報を得る</span>
        <span class="c1">#包含矩形の処理は自身の責任で行う．</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrange_me_post</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.arrange()=&gt; box=</span><span class="si">{</span> <span class="n">boxes</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children_indexed</span><span class="p">():</span>
                <span class="n">trans</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">pair</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@debug:arrange </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1"> trans=</span><span class="si">{</span><span class="n">trans</span><span class="si">}</span><span class="s1">, child=</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">::</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span></div>

    <span class="k">pass</span></div>

<span class="c1">#=====</span>
<span class="c1"># 配置ボードのクラス</span>
<span class="c1">#=====</span>
<div class="viewcode-block" id="Packer"><a class="viewcode-back" href="../cboard.html#cboard.Packer">[docs]</a><span class="k">class</span> <span class="nc">Packer</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;パッカーのクラス</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画盤オブジェクトを初期化する</span>
<span class="sd">        Args: </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#親の初期化</span>
        <span class="c1">#初期化</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="o">=</span><span class="n">align</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">=</span><span class="n">fit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.__init__(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">#To be Override</span>
<div class="viewcode-block" id="Packer.arrange_me_post"><a class="viewcode-back" href="../cboard.html#cboard.Packer.arrange_me_post">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_me_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の座標系で配置を計算する．子孫クラスでオーバーライドすること&quot;&quot;&quot;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">box</span> </div>

    <span class="c1"># 派生：Override</span>
<div class="viewcode-block" id="Packer.draw_me_post"><a class="viewcode-back" href="../cboard.html#cboard.Packer.draw_me_post">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;自分の描画を行う．子孫クラスでオーバーライドすること．</span>
<span class="sd">        Args: </span>
<span class="sd">            cr (Cairo.Context) : Cairoの文脈オブジェクト</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me()...&#39;</span><span class="p">)</span>
        <span class="c1">## ここでcontext crに何か描く．</span>
        <span class="k">return</span> </div>

    <span class="k">pass</span></div>

<span class="c1">##======</span>
<span class="c1">## 描画演算オブジェクト</span>
<span class="c1">##======</span>

<div class="viewcode-block" id="DrawCommandBase"><a class="viewcode-back" href="../cboard.html#cboard.DrawCommandBase">[docs]</a><span class="k">class</span> <span class="nc">DrawCommandBase</span><span class="p">(</span><span class="n">Board</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトの基底クラス．Boardクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#命令の名前</span>
                 <span class="o">**</span><span class="n">kwargs</span>  <span class="c1">#命令の引数</span>
                 <span class="p">):</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="n">cmd</span><span class="o">!=</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;DrawCommandBase(): cmd must not be None!&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">(): cmd=</span><span class="si">{</span> <span class="n">cmd</span> <span class="si">}</span><span class="s1"> kwargs=</span><span class="si">{</span> <span class="n">kwargs</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">com</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;cmd=</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1"> must be str!&#39;</span><span class="p">)</span>

        <span class="c1">#命令を格納する</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span>     <span class="o">=</span> <span class="n">cmd</span> 
        <span class="c1"># self.kwargs  = kwargs  #exp</span>
        <span class="k">return</span>


    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCommandBase.draw_me"><a class="viewcode-back" href="../cboard.html#cboard.DrawCommandBase.draw_me">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bname</span><span class="p">()</span><span class="si">}</span><span class="s1">.draw_me(): </span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">kwargs1</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;source_rgb&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_rgb&#39;</span><span class="p">,</span> <span class="s1">&#39;line_width&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_me_impl</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        <span class="k">return</span> </div>

    <span class="c1">#Override: To be implemented </span>
<div class="viewcode-block" id="DrawCommandBase.draw_me_impl"><a class="viewcode-back" href="../cboard.html#cboard.DrawCommandBase.draw_me_impl">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To be implemented </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> </div>
        
    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCommandBase.get_kwargs"><a class="viewcode-back" href="../cboard.html#cboard.DrawCommandBase.get_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span></div>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="DrawCommandTemplate"><a class="viewcode-back" href="../cboard.html#cboard.DrawCommandTemplate">[docs]</a><span class="k">class</span> <span class="nc">DrawCommandTemplate</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> </div>

<span class="c1">#======</span>
<span class="c1"># 単一図形描画</span>
<span class="c1">#======</span>
<span class="n">CFSIZE</span><span class="o">=</span><span class="mi">4</span>
<div class="viewcode-block" id="DrawRectangle"><a class="viewcode-back" href="../cboard.html#cboard.DrawRectangle">[docs]</a><span class="k">class</span> <span class="nc">DrawRectangle</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;rectangle&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> 

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawRectangle.arrange_me"><a class="viewcode-back" href="../cboard.html#cboard.DrawRectangle.arrange_me">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span> </div>
        
    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawRectangle.draw_me_impl"><a class="viewcode-back" href="../cboard.html#cboard.DrawRectangle.draw_me_impl">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_rectangle</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">)</span> <span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ratio=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;box_=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;show_native_origin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_draw_marker_cross</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> 
                                     <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">return</span> </div></div>

<div class="viewcode-block" id="DrawCircle"><a class="viewcode-back" href="../cboard.html#cboard.DrawCircle">[docs]</a><span class="k">class</span> <span class="nc">DrawCircle</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> 

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCircle.arrange_me"><a class="viewcode-back" href="../cboard.html#cboard.DrawCircle.arrange_me">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span> </div>
        
    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawCircle.draw_me_impl"><a class="viewcode-back" href="../cboard.html#cboard.DrawCircle.draw_me_impl">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="c1"># Note: self.kwargs contains keys &#39;x&#39;, &#39;y&#39;, &#39;r&#39;. </span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_circle</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_self</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">)</span><span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ratio=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_ratio_y</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_text</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">ox</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">oy</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">CFSIZE</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="n">CFSIZE</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;box_=</span><span class="si">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_self</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#debug</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;show_native_origin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">crt</span><span class="o">.</span><span class="n">cr_draw_marker_cross</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> 
                                     <span class="n">rgb</span><span class="o">=</span><span class="n">crt</span><span class="o">.</span><span class="n">cr_add_alpha</span><span class="p">(</span><span class="n">crt</span><span class="o">.</span><span class="n">MYCOL</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">return</span> </div></div>

<span class="c1"># #未使用</span>
<span class="c1"># class DrawArc(DrawCommandBase):</span>
<span class="c1">#     &quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, **kwargs):</span>
<span class="c1">#         super().__init__(cmd=&#39;arc&#39;, **kwargs)</span>
<span class="c1">#         return </span>

<span class="c1">#     #Override </span>
<span class="c1">#     def arrange_me(self):</span>
<span class="c1">#         box = (0, 0)</span>
<span class="c1">#         return box </span>
        
<span class="c1">#     #Override </span>
<span class="c1">#     def draw_me_impl(self, cr):</span>
<span class="c1">#         crt.cr_arc(context=cr, **self.kwargs) </span>
<span class="c1">#         return </span>

<span class="c1">#======</span>
<span class="c1"># 線分列の描画</span>
<span class="c1">#======</span>

<span class="c1">#constants</span>
<span class="n">CMD_MOVE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CMD_LINE</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="DrawPolyLines"><a class="viewcode-back" href="../cboard.html#cboard.DrawPolyLines">[docs]</a><span class="k">class</span> <span class="nc">DrawPolyLines</span><span class="p">(</span><span class="n">DrawCommandBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;polylines&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> 

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawPolyLines.arrange_me"><a class="viewcode-back" href="../cboard.html#cboard.DrawPolyLines.arrange_me">[docs]</a>    <span class="k">def</span> <span class="nf">arrange_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#命令全ての包含長方形を計算する</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">EMPTY_RECT</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="p">):</span>
            <span class="n">cmd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="n">boxes</span> <span class="o">=</span> <span class="n">crt</span><span class="o">.</span><span class="n">box_union</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;@debug:polyline: boxes=</span><span class="si">{</span><span class="n">boxes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">boxes</span> </div>

    <span class="c1">#Override </span>
<div class="viewcode-block" id="DrawPolyLines.draw_me_impl"><a class="viewcode-back" href="../cboard.html#cboard.DrawPolyLines.draw_me_impl">[docs]</a>    <span class="k">def</span> <span class="nf">draw_me_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_set_context_parameters</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">x_last</span><span class="p">,</span> <span class="n">y_last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span> 
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="p">):</span>
            <span class="n">cmd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span> <span class="o">=</span> <span class="n">pair</span> <span class="c1">#分解</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="o">==</span><span class="n">CMD_MOVE</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@debug: cr_move_to: </span><span class="si">{</span> <span class="n">kwargs</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">crt</span><span class="o">.</span><span class="n">cr_move_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span><span class="o">==</span><span class="n">CMD_LINE</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;has_arrow&#39;</span><span class="p">:</span> <span class="n">has_arrow</span><span class="p">,</span>
                             <span class="s1">&#39;x_last&#39;</span><span class="p">:</span> <span class="n">x_last</span><span class="p">,</span> <span class="s1">&#39;y_last&#39;</span><span class="p">:</span> <span class="n">y_last</span><span class="p">,</span> <span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">(</span><span class="n">isChild</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;@debug: cr_line_to: </span><span class="si">{</span> <span class="n">kwargs</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_last</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_last</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">crt</span><span class="o">.</span><span class="n">cr_line_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> 
                                   <span class="n">x_last</span><span class="o">=</span><span class="n">x_last</span><span class="p">,</span> <span class="n">y_last</span><span class="o">=</span><span class="n">y_last</span><span class="p">,</span>
                                   <span class="n">has_arrow</span><span class="o">=</span><span class="n">has_arrow</span><span class="p">,</span>
                                   <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">com</span><span class="o">.</span><span class="n">panic</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PolyLines.draw_me_impl: no such cmd=</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
            <span class="n">x_last</span><span class="p">,</span> <span class="n">y_last</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> 
            <span class="k">pass</span>
        <span class="n">crt</span><span class="o">.</span><span class="n">cr_process_stroke_or_fill</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="DrawPolyLines.move_to"><a class="viewcode-back" href="../cboard.html#cboard.DrawPolyLines.move_to">[docs]</a>    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args : </span>
<span class="sd">          x, y (float) : x- and y-coodinates</span>
<span class="sd">        Returns:</span>
<span class="sd">            (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_arrow</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">CMD_MOVE</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="c1">#for cascade object interface </span></div>
    
<div class="viewcode-block" id="DrawPolyLines.line_to"><a class="viewcode-back" href="../cboard.html#cboard.DrawPolyLines.line_to">[docs]</a>    <span class="k">def</span> <span class="nf">line_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args : </span>
<span class="sd">          x, y (float) : x- and y-coodinates</span>
<span class="sd">        Returns:</span>
<span class="sd">            (Board) : 自分自身．いわゆる&#39;cascade object call interface&#39; のため．</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CMDS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">CMD_LINE</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">has_arrow</span><span class="p">))</span> 
        <span class="k">return</span> <span class="bp">self</span> <span class="c1">#for cascade object interface </span></div>
    
    <span class="k">pass</span> </div>

<div class="viewcode-block" id="DrawMarkerCross"><a class="viewcode-back" href="../cboard.html#cboard.DrawMarkerCross">[docs]</a><span class="k">class</span> <span class="nc">DrawMarkerCross</span><span class="p">(</span><span class="n">DrawPolyLines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;描画演算オブジェクトのクラス．DrawCommandBaseクラスのサブクラス．</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># kwargs[&#39;x&#39;] = kw.get(kwargs, &#39;x&#39;, default=0.0)</span>
        <span class="c1"># kwargs[&#39;y&#39;] = kw.get(kwargs, &#39;y&#39;, default=0.0)        </span>
        <span class="n">ticklen</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;ticklen&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span>
                           <span class="n">altkeys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;line_width&#39;</span><span class="p">,</span> <span class="s1">&#39;pen_width&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># clen = 5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to</span><span class="p">(</span><span class="n">ticklen</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">return</span> </div>




<span class="c1">#======</span>
<span class="c1"># 関数終わり</span>
<span class="c1">#======</span>

<span class="c1"># ## メイン文</span>
<span class="c1"># if __name__ == &#39;__main__&#39;:</span>
<span class="c1">#     shape = (9,6)</span>
<span class="c1">#     reg = ImageBoard(ratio=128, shape=shape, xy = (0.5, 0.5))</span>
<span class="c1">#     print(&#39;reg: \n&#39;, vars(reg))</span>
    
<span class="c1">##EOF</span>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">GridBoard</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cboard.html">cboard module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cimage.html">cimage module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common.html">common module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crtool.html">crtool module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">help module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kwargs.html">kwargs module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path.html">path module</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Hiroki Arimura, Hokkaido University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>